{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the CineStream application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "User's phone number."
        },
        "signUpDate": {
          "type": "string",
          "description": "Date when the user signed up.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "signUpDate"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category for videos in the CineStream application.  Supports a three-level hierarchy (e.g., Genre > Subgenre > Specific Category).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        },
        "parentCategoryId": {
          "type": "string",
          "description": "Reference to the parent Category. Null if it is a top-level category. (Relationship: Category 1:N Category)"
        },
        "level": {
          "type": "number",
          "description": "The level of the category in the hierarchy. 1 for top-level, 2 for sub-category, 3 for specific category."
        }
      },
      "required": [
        "id",
        "name",
        "level"
      ]
    },
    "Video": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Video",
      "type": "object",
      "description": "Represents a video in the CineStream application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the video entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the video."
        },
        "description": {
          "type": "string",
          "description": "Description of the video content."
        },
        "instructor": {
          "type": "string",
          "description": "Name of the instructor or creator of the video."
        },
        "duration": {
          "type": "number",
          "description": "Duration of the video in seconds."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Video)"
        },
        "videoUrl": {
          "type": "string",
          "description": "URL of the video file.",
          "format": "uri"
        },
        "thumbnailUrl": {
          "type": "string",
          "description": "URL of the video thumbnail image.",
          "format": "uri"
        },
        "uploadDate": {
          "type": "string",
          "description": "Date when the video was uploaded.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "categoryId",
        "videoUrl",
        "thumbnailUrl",
        "uploadDate"
      ]
    },
    "VideoLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VideoLog",
      "type": "object",
      "description": "Represents a user's viewing history for a video.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the video log entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N VideoLog)"
        },
        "videoId": {
          "type": "string",
          "description": "Reference to Video. (Relationship: Video 1:N VideoLog)"
        },
        "watchDate": {
          "type": "string",
          "description": "Date and time when the video was watched.",
          "format": "date-time"
        },
        "watchDuration": {
          "type": "number",
          "description": "The duration of the video that was watched in seconds."
        }
      },
      "required": [
        "id",
        "userId",
        "videoId",
        "watchDate"
      ]
    },
    "Pricing": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Pricing",
      "type": "object",
      "description": "Represents the pricing options for subscriptions and token packages.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the pricing option."
        },
        "type": {
          "type": "string",
          "description": "Type of pricing option (e.g., 'subscription', 'token_package')."
        },
        "name": {
          "type": "string",
          "description": "Name of the pricing plan or token package."
        },
        "description": {
          "type": "string",
          "description": "Description of the pricing plan/token package."
        },
        "price": {
          "type": "number",
          "description": "Price of the subscription or token package."
        },
        "duration": {
          "type": "string",
          "description": "Duration of the subscription period (e.g., '1 week', '1 month').  Applicable only for subscription type."
        },
        "tokens": {
          "type": "number",
          "description": "Number of tokens included in the package. Applicable only for token_package type."
        }
      },
      "required": [
        "id",
        "type",
        "name",
        "price"
      ]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Represents a user's subscription to CineStream.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the subscription."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Subscription)"
        },
        "pricingId": {
          "type": "string",
          "description": "Reference to Pricing. (Relationship: Pricing 1:N Subscription)"
        },
        "startDate": {
          "type": "string",
          "description": "Date when the subscription started.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "Date when the subscription ends.",
          "format": "date-time"
        },
        "autoRenew": {
          "type": "boolean",
          "description": "Indicates whether the subscription automatically renews."
        }
      },
      "required": [
        "id",
        "userId",
        "pricingId",
        "startDate",
        "endDate"
      ]
    },
    "TokenPurchase": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TokenPurchase",
      "type": "object",
      "description": "Represents a user's purchase of tokens.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the token purchase."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N TokenPurchase)"
        },
        "pricingId": {
          "type": "string",
          "description": "Reference to Pricing. (Relationship: Pricing 1:N TokenPurchase)"
        },
        "purchaseDate": {
          "type": "string",
          "description": "Date when the tokens were purchased.",
          "format": "date-time"
        },
        "tokensPurchased": {
          "type": "number",
          "description": "Number of tokens purchased."
        }
      },
      "required": [
        "id",
        "userId",
        "pricingId",
        "purchaseDate",
        "tokensPurchased"
      ]
    },
    "ServiceTokenHistory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ServiceTokenHistory",
      "type": "object",
      "description": "Represents an instance when an admin provides service tokens to a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the service token grant."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N ServiceTokenHistory)"
        },
        "tokensGranted": {
          "type": "number",
          "description": "Number of tokens granted to the user."
        },
        "grantDate": {
          "type": "string",
          "description": "Date when the tokens were granted.",
          "format": "date-time"
        },
        "adminId": {
          "type": "string",
          "description": "Reference to the admin user who granted the tokens.  This would reference the User entity."
        },
        "reason": {
          "type": "string",
          "description": "Reason for granting the tokens."
        }
      },
      "required": [
        "id",
        "userId",
        "tokensGranted",
        "grantDate",
        "adminId"
      ]
    },
    "AppSetting": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AppSetting",
      "type": "object",
      "description": "Represents application-wide settings that can be configured by the admin.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the setting."
        },
        "settingKey": {
          "type": "string",
          "description": "Key for the setting (e.g., 'appName', 'logoUrl', 'themeColor')."
        },
        "settingValue": {
          "type": "string",
          "description": "Value of the setting."
        }
      },
      "required": [
        "id",
        "settingKey",
        "settingValue"
      ]
    },
    "UserChangeLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserChangeLog",
      "type": "object",
      "description": "Represents a log of changes made to a user's profile information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the change log entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N UserChangeLog)"
        },
        "changeDate": {
          "type": "string",
          "description": "Date and time when the change was made.",
          "format": "date-time"
        },
        "changedField": {
          "type": "string",
          "description": "The name of the field that was changed (e.g., 'email', 'phoneNumber')."
        },
        "oldValue": {
          "type": "string",
          "description": "The previous value of the field."
        },
        "newValue": {
          "type": "string",
          "description": "The new value of the field."
        },
        "adminId": {
          "type": "string",
          "description": "Reference to the admin user who made the change (if applicable). This would reference the User entity."
        }
      },
      "required": [
        "id",
        "userId",
        "changeDate",
        "changedField",
        "oldValue",
        "newValue"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Includes a 'userId' parameter.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores category information. Includes a 'categoryId' parameter.",
          "params": [
            {
              "name": "categoryId",
              "description": "The unique identifier for the category."
            }
          ]
        }
      },
      {
        "path": "/videos/{videoId}",
        "definition": {
          "entityName": "Video",
          "schema": {
            "$ref": "#/backend/entities/Video"
          },
          "description": "Stores video metadata. Includes a 'videoId' parameter.",
          "params": [
            {
              "name": "videoId",
              "description": "The unique identifier for the video."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/videoLogs/{videoLogId}",
        "definition": {
          "entityName": "VideoLog",
          "schema": {
            "$ref": "#/backend/entities/VideoLog"
          },
          "description": "Stores user's video viewing history. Includes 'userId' and 'videoLogId' parameters.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "videoLogId",
              "description": "The unique identifier for the video log entry."
            }
          ]
        }
      },
      {
        "path": "/settings/pricing",
        "definition": {
          "entityName": "Pricing",
          "schema": {
            "$ref": "#/backend/entities/Pricing"
          },
          "description": "Stores pricing information for subscriptions and token packages.  This is a singleton document.",
          "params": []
        }
      },
      {
        "path": "/users/{userId}/subscriptions/{subscriptionId}",
        "definition": {
          "entityName": "Subscription",
          "schema": {
            "$ref": "#/backend/entities/Subscription"
          },
          "description": "Stores user subscription information. Includes 'userId' and 'subscriptionId' parameters.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "subscriptionId",
              "description": "The unique identifier for the subscription."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/tokenPurchases/{tokenPurchaseId}",
        "definition": {
          "entityName": "TokenPurchase",
          "schema": {
            "$ref": "#/backend/entities/TokenPurchase"
          },
          "description": "Stores user's token purchase history. Includes 'userId' and 'tokenPurchaseId' parameters.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "tokenPurchaseId",
              "description": "The unique identifier for the token purchase."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/serviceTokenHistory/{serviceTokenHistoryId}",
        "definition": {
          "entityName": "ServiceTokenHistory",
          "schema": {
            "$ref": "#/backend/entities/ServiceTokenHistory"
          },
          "description": "Stores history of service tokens granted to users by admins. Includes 'userId' and 'serviceTokenHistoryId' parameters.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "serviceTokenHistoryId",
              "description": "The unique identifier for the service token history entry."
            }
          ]
        }
      },
      {
        "path": "/appSettings/{appSettingId}",
        "definition": {
          "entityName": "AppSetting",
          "schema": {
            "$ref": "#/backend/entities/AppSetting"
          },
          "description": "Stores application-wide settings. Includes an 'appSettingId' parameter.",
          "params": [
            {
              "name": "appSettingId",
              "description": "The unique identifier for the app setting."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/changeLogs/{changeLogId}",
        "definition": {
          "entityName": "UserChangeLog",
          "schema": {
            "$ref": "#/backend/entities/UserChangeLog"
          },
          "description": "Stores a log of changes made to a user's profile information. Includes 'userId' and 'changeLogId' parameters.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "changeLogId",
              "description": "The unique identifier for the change log entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the CineStream application's features, focusing on scalability, security, and ease of management. It prioritizes authorization independence by denormalizing data where necessary and uses structural segregation to maintain a homogeneous security posture within each collection.  The structure also supports the QAPs (Rules are not Filters) principle by avoiding complex queries in rules and standardizing access models.\n\n*Authorization Independence:*\nAuthorization Independence is achieved through denormalization. For example, if access to `videoLogs` needed to be restricted based on a user's subscription status, that subscription information would be denormalized into the `videoLogs` document.  However, given that the provided requirements indicate open read/write access for authenticated users in the early development phase, the need for extensive denormalization is currently minimized.  As security requirements evolve, denormalization should be revisited.\n\n*QAPs (Rules are not Filters):*\nThe structure uses segregation to support secure listing operations. Each collection is designed with a specific access pattern in mind, avoiding the need to filter based on document content in security rules. For example, user-specific data (subscriptions, token purchases, video logs) are stored in subcollections under the `/users/{userId}` path, allowing rules to easily enforce ownership.\n\nMembership Maps are not explicitly needed at this stage due to the open access policy during development. However, if collaborative features are added later (e.g., shared playlists), membership maps in dedicated collections would be the preferred approach.\n\n*Global Roles (DBAC):*  Since all authenticated users have read/write access, a dedicated `/roles_admin/{uid}` is not required at this time.  If, in the future, admin-specific permissions need to be locked down, the existence of a document in this collection can be used to grant elevated privileges.\n\n*Invariants:*\nThe structure supports invariants like ownership by using hierarchical paths for user-owned data (e.g., `/users/{userId}/subscriptions/{subscriptionId}`). Timestamps can be enforced using serverTimestamp() in Firestore rules. Denormalized data (if added later) should be updated using transactions or batched writes to maintain consistency.\n\nExplicit state modeling (using a `status` field) isn't extensively used in the current data model but can be added to entities like `Subscription` if the application logic requires more explicit state management (e.g., `ACTIVE`, `EXPIRED`, `CANCELED`)."
  }
}